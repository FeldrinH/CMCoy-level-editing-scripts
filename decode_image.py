from PIL import Image

colorTable = [0,14089725,1023142,16579589,890871,896347,526934,16158734,11390496,509947,5704204,10816013,16189453,718087,985590,5633289,5831062,9894494,8344567,11730429,16274960,6052364,11229298,16274563,11405944,15733745,10593032,762890,261323,11271122,11116967,16645165,460550,783695,876119,10704907,13171970,678314,1270008,723877,16284664,6818727,6070876,13761149,8453318,11048016,6773415,678409,392444,16226395,16711031,5871609,16385912,6026832,7735287,13748469,6290682,12909643,3275967,16566277,16645321,6071561,5637469,13289219,4179959,772791,16448673,5660506,16710909,8506108,9762569,16370048,13761472,16631548,9239804,9096887,16579917,16700240,10981109,3210749,16435245,719762,16420776,11008156,6463143,11126780,11782751,16172225,13171753,13171752]
textTable = ["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","-","=","~","@","#","$","%","^","&","*","(",")","_","+","<",">",",",".",";",":","\'","\"","?","|","\\","/"," "]

def pixelToUInt(pixel):
    r, g, b = pixel
    return b | (g << 8) | (r << 16)

def getCharacter(pixel):
    uint = pixelToUInt(pixel)

    index = colorTable.index(uint)
    if len(textTable) > index:
        return textTable[index]

    print("Miss")
    return ""

def decode_image(imagefile_path, xmlfile_path):
    imagefile = Image.open(imagefile_path)
    bitmap = imagefile.load()
    width, height = imagefile.size
    print(width, height)

    y = 0 # loc5
    x = 0 # loc6

    text = ""

    while y < height:
        x = 0
        while x < width:
            text += getCharacter(bitmap[x, y])
            x += 1
        y += 1

    with open(xmlfile_path, "w") as wf:
        wf.write(text)
